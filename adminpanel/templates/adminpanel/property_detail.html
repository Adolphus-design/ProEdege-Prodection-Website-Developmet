{% extends "base.html" %}
{% load static %}

{% block content %}
<h2>Property Details</h2>

<table>
    <tr><th>Title:</th><td>{{ property.title }}</td></tr>
    <tr><th>Description:</th><td>{{ property.description }}</td></tr>
    <tr><th>Price:</th><td>R {{ property.price|floatformat:2 }}</td></tr>
    <tr><th>Location:</th><td>{{ property.location }}</td></tr>
    <tr><th>Latitude:</th><td>{{ property.latitude }}</td></tr>
    <tr><th>Longitude:</th><td>{{ property.longitude }}</td></tr>
    <tr><th>Property Type:</th><td>{{ property.property_type }}</td></tr>
    <tr><th>Listing Type:</th><td>{{ property.listing_type }}</td></tr>
    <tr><th>Status:</th><td>{{ property.status }}</td></tr>
    <tr><th>Created At:</th><td>{{ property.created_at }}</td></tr>
    <tr><th>Seller:</th><td>{{ property.seller.username }}</td></tr>

    {% if property.floor_plan %}
    <tr><th>Floor Plan:</th>
        <td>
            <a href="{{ property.floor_plan.url }}" target="_blank">View Floor Plan</a>
        </td>
    </tr>
    {% endif %}
</table>

<h3>Property Location Map</h3>

{% if property.latitude and property.longitude %}
    <div style="width: 100%; max-width: 800px; height: 400px; margin-bottom: 20px;">
        <iframe
            width="100%"
            height="100%"
            frameborder="0"
            style="border:0"
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps?q={{ property.latitude }},{{ property.longitude }}&output=embed"
            allowfullscreen>
        </iframe>
    </div>
{% else %}
    <p><em>No map available ‚Äî coordinates not set.</em></p>
{% endif %}


{% if images %}
    <h3>Images</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for image in images %}
            <div style="border: 1px solid #ccc; padding: 5px;">
                <img src="{{ image.image.url }}" alt="Property Image" width="200">
            </div>
        {% endfor %}
    </div>
{% endif %}

<h3>Upload Images</h3>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.image.label_tag }}<br>
    {{ form.image }}<br><br>
    <button type="submit">Upload</button>
</form>

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<br>
<a href="{% url 'adminpanel:approve_property' property.id %}">‚úÖ Approve</a> |
<a href="{% url 'adminpanel:reject_property' property.id %}">‚ùå Reject</a> |
<a href="{% url 'adminpanel:edit_property' property.id %}">‚úèÔ∏è Edit</a> |
<a href="{% url 'adminpanel:delete_property' property.id %}" onclick="return confirm('Delete this property?');">üóëÔ∏è Delete</a> |
<a href="{% url 'adminpanel:property_list' %}">üîô Back to Property List</a>
{% endblock %}
