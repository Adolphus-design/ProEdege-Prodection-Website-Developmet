{% extends "base.html" %}

{% block content %}
<div class="container my-5">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Assign Agent(s) to Property</h2>
    <a href="{% url 'agency_dashboard' %}" class="btn btn-outline-secondary">‚Üê Back to Dashboard</a>
  </div>

  <!-- Property Info Card -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">{{ property.title }}</h5>
      <p class="card-text">
        <strong>Location:</strong> {{ property.location }}<br>
        <strong>Price:</strong> R{{ property.price|floatformat:2 }}<br>
        <strong>Status:</strong> {{ property.status|title }}
      </p>
    </div>
  </div>

  <!-- Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Assign Agents Form -->
  <div class="card">
    <div class="card-body">
      <form method="POST">
        {% csrf_token %}
        <div class="mb-3">
          <label for="agents" class="form-label">Select Agent(s)</label>
          <select name="agents" id="agents" class="form-select" multiple size="6">
            {% for agent in agents %}
              <option value="{{ agent.id }}"
                {% if agent in property.agents.all %}selected{% endif %}>
                {{ agent.userprofile.full_name|default:agent.username }} ({{ agent.username }})
              </option>
            {% endfor %}
          </select>
          <small class="form-text text-muted">
            Hold <kbd>Ctrl</kbd> (Windows) or <kbd>Cmd</kbd> (Mac) to select multiple agents.
          </small>
        </div>

        <button type="submit" class="btn btn-primary">Assign Agent(s)</button>
      </form>
    </div>
  </div>

  <!-- Currently Assigned Agents -->
  <div class="mt-4">
    <h5>Currently Assigned Agents</h5>
    {% if property.agents.all %}
      <ul class="list-group">
        {% for agent in property.agents.all %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ agent.userprofile.full_name|default:agent.username }} ({{ agent.username }})
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No agents assigned yet.</p>
    {% endif %}
  </div>

</div>
{% endblock %}
