{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-5">
  <div class="container" style="margin-top:80px;">
    <h2 class="mb-3 text-center">Available Properties in South Africa</h2>
  </div>

  <hr>
<!-- SVG Map -->
 <!--
<div class="sa-map-container">
    <object id="sa-map" type="image/svg+xml" data="{% static 'maps/south_africa.svg' %}" style="width:100%; height:100%;"></object>
</div>-->

  <!-- Province Filter Cards (Optional) -->
  {% if provinces %}
    <div class="row row-cols-2 row-cols-md-4 g-3 mb-5">
      {% for province in provinces %}
        <div class="col">
          <a href="{% url 'province_properties' province.id %}" class="text-decoration-none">
            <div class="card text-center shadow-sm border border-dark">
              <div class="card-body p-3">
                <strong class="text-dark">{{ province.name }}</strong>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Property Grid -->
  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for property in properties %}
      <div class="col">
        <div class="card h-100 shadow-sm position-relative border">

          <!-- SOLD badge -->
          {% if property.status == 'sold' %}
            <div class="position-absolute top-0 start-0 bg-danger text-white px-3 py-1 fw-bold rounded-end">
              SOLD
            </div>
          {% endif %}

          <!-- Agency Logo (if exists) -->
          {% if property.agent.agentprofile and property.agent.agentprofile.agency and property.agent.agentprofile.agency.logo %}
            <img src="{{ property.agent.agentprofile.agency.logo.url }}" 
                 alt="{{ property.agent.agentprofile.agency.name }} Logo"
                 class="position-absolute top-0 end-0 m-2" 
                 style="width: 50px; height: 50px; object-fit: contain; border-radius:5px;">
          {% endif %}

          <!-- Image -->
          <a href="{% url 'property_detail' property.id %}">
            {% with main_image_url=property.get_main_image_url %}
              {% if main_image_url %}
                <img src="{{ main_image_url }}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="Property image">
              {% else %}
                <img src="{% static 'images/default.jpg' %}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="Default image">
              {% endif %}
            {% endwith %}
          </a>

          <!-- Body -->
          <div class="card-body">
            <h5 class="card-title">{{ property.title }}</h5>
            <p class="card-text text-muted mb-1"><i class="fas fa-map-marker-alt me-1"></i> {{ property.location }} | {{ property.province }}</p>
            <p class="text-danger fw-bold fs-5">R {{ property.price|floatformat:0 }}</p>

            <!-- Specs -->
            <div class="d-flex justify-content-start gap-3 text-secondary small mt-2">
              {% if property.number_of_bedrooms %}
                <span><i class="fas fa-bed me-1"></i> {{ property.number_of_bedrooms }}</span>
              {% endif %}
              {% if property.number_of_bathrooms %}
                <span><i class="fas fa-shower me-1"></i> {{ property.number_of_bathrooms }}</span>
              {% endif %}
              {% if property.number_of_garages %}
                <span><i class="fas fa-warehouse me-1"></i> {{ property.number_of_garages }}</span>
              {% endif %}
            </div>

            <a href="{% url 'property_detail' property.id %}" class="btn btn-dark btn-sm mt-3 w-100">
              View Details
            </a>
          </div>
        </div>
      </div>
    {% empty %}
      <p class="text-center text-muted">No properties available at the moment.</p>
    {% endfor %}
  </div>
</div>




<script>
document.querySelectorAll('.sa-map path, .sa-map polygon').forEach(region => {
    const provinceName = region.getAttribute('id') || region.getAttribute('data-name');

    region.addEventListener('click', () => {
        // Redirect to the province-filtered view
        window.location.href = "{% url 'province_properties' 'REPLACE_PROVINCE' %}".replace('REPLACE_PROVINCE', provinceName);
    });
});
</script>

<style>
  .sa-map path, .sa-map polygon {
    fill: #c0c0c0;       /* Default province color */
    stroke: #000;         /* Border */
    stroke-width: 0.5;
    transition: fill 0.3s; /* Smooth hover effect */
}

.sa-map path:hover, .sa-map polygon:hover {
    fill: #ff0000;        /* Highlight on hover */
    cursor: pointer;
}
</style>


{% endblock %}
