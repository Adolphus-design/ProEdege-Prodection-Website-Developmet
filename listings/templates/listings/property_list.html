{% extends 'base.html' %}
{% load static %}
{% block content %}

<h2>Available Properties</h2>

<!-- templates/property_list.html -->
<h2 class="text-xl font-bold mb-4">Browse by Province</h2>
<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-8">
  {% for province in provinces %}
    <a href="{% url 'province_properties' province.id %}"
       class="block bg-white rounded-lg border p-4 hover:shadow-md transition">
      <p class="text-center text-sm font-semibold text-gray-800">{{ province.name }}</p>
    </a>
  {% endfor %}
</div>


<div class="property-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 20px 0;">
  {% for property in properties %}
    <div class="property-card" style="border: 1px solid #ddd; border-radius: 10px; overflow: hidden; position: relative; box-shadow: 0 0 8px rgba(0,0,0,0.1);">
      
      {% if property.is_sold %}
        <div style="position: absolute; top: 10px; left: 10px; background-color: red; color: white; padding: 5px 10px; border-radius: 4px; font-weight: bold;">
          SOLD
        </div>
      {% endif %}

      <a href="{% url 'property_detail' property.id %}">
        {% if property.main_image %}
          <img src="{{ property.main_image.url }}" alt="{{ property.title }}" style="width: 100%; height: 200px; object-fit: cover;">
        {% else %}
          {% with property.images.first as first_image %}
            {% if first_image %}
              <img src="{{ first_image.image.url }}" alt="{{ property.title }}" style="width: 100%; height: 200px; object-fit: cover;">
            {% else %}
              <img src="{% static 'images/default.jpg' %}" alt="No image" style="width: 100%; height: 200px; object-fit: cover;">
            {% endif %}
          {% endwith %}
        {% endif %}
      </a>

      <div style="padding: 15px;">
        <h3 style="margin-bottom: 5px;">{{ property.title }}</h3>
        <p style="color: gray; margin-bottom: 10px;">{{ property.city }} {{ property.province }}</p>
        <p style="font-weight: bold; font-size: 1.2rem; margin-bottom: 10px;">R {{ property.price|floatformat:0 }}</p>

        <div style="display: flex; gap: 10px; font-size: 0.9rem; color: #555;">
          {% if property.bedrooms %}<span>üõè {{ property.bedrooms }}</span>{% endif %}
          {% if property.bathrooms %}<span>üõÅ {{ property.bathrooms }}</span>{% endif %}
          {% if property.garages %}<span>üöó {{ property.garages }}</span>{% endif %}
        </div>

        <a href="{% url 'property_detail' property.id %}" style="display: inline-block; margin-top: 15px; padding: 8px 12px; background: #007bff; color: white; border-radius: 5px; text-decoration: none;">
          View Details
        </a>
      </div>

    </div>
  {% empty %}
    <p>No properties available at the moment.</p>
  {% endfor %}
</div>

{% endblock %}
