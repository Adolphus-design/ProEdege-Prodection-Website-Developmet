{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-5">

  <!-- Main Image + Overlay -->
  {% if images %}
    <div class="position-relative mb-4">
      <img src="{{ images.0.image.url }}" class="img-fluid rounded w-100" style="height: 400px; object-fit: cover;" alt="Main Image">

      <!-- Overlay Card -->
      <div class="position-absolute top-0 start-0 bg-dark bg-opacity-75 text-white p-3 rounded m-3" style="max-width: 340px;">
        <h4 class="mb-2">{{ property.title }}</h4>
        <p class="mb-2"><i class="fas fa-map-marker-alt me-1"></i> {{ property.location }}, {{ property.province }}</p>

        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="mb-0 text-danger fw-bold">R{{ property.price|floatformat:0 }}</h4>
          <a href="{% url 'submit_interest' property.id %}" class="btn btn-danger btn-sm">Make Offer</a>
        </div>

        <div class="d-flex gap-3 mt-3 small">
          {% if property.number_of_bedrooms %}<span><i class="fas fa-bed"></i> {{ property.number_of_bedrooms }}</span>{% endif %}
          {% if property.number_of_bathrooms %}<span><i class="fas fa-shower"></i> {{ property.number_of_bathrooms }}</span>{% endif %}
          {% if property.number_of_kitchens %}<span><i class="fas fa-utensils"></i> {{ property.number_of_kitchens }}</span>{% endif %}
          {% if property.number_of_garages %}<span><i class="fas fa-warehouse"></i> {{ property.number_of_garages }}</span>{% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Quick Nav Buttons -->
  <div class="d-flex flex-wrap gap-2 mb-4">
    <a href="#overview" class="btn btn-outline-dark btn-sm"><i class="fas fa-home me-1"></i> Overview</a>
    <a href="#seller" class="btn btn-outline-dark btn-sm"><i class="fas fa-user me-1"></i> Seller Info</a>
    <a href="#features" class="btn btn-outline-dark btn-sm"><i class="fas fa-list me-1"></i> Key Features</a>
    <a href="#lightgallery" class="btn btn-outline-dark btn-sm"><i class="fas fa-images me-1"></i> Gallery</a>
    <a href="#map" class="btn btn-outline-dark btn-sm"><i class="fas fa-map-marked-alt me-1"></i> Map</a>
  </div>

  <!-- Overview & Seller Side-by-Side -->
  <div class="row mb-5">
    <div class="col-md-8" id="overview">
      <h5 class="mb-3 border-bottom pb-2">Property Overview</h5>
      <p>{{ property.description }}</p>
    </div>
    <div class="col-md-4" id="seller">
  <h5 class="mb-3 border-bottom pb-2">Seller / Agent Info</h5>
  {% if user.is_authenticated %}
    <div class="bg-light p-3 rounded shadow-sm d-flex align-items-center gap-3">
      {% if property.seller.userprofile.profile_picture %}
        <img src="{{ property.seller.userprofile.profile_picture.url }}" alt="Profile Picture"
             class="rounded-circle border" style="width: 60px; height: 60px; object-fit: cover;">
      {% else %}
        <div class="rounded-circle bg-secondary d-flex justify-content-center align-items-center text-white fw-bold"
             style="width: 60px; height: 60px;">
          {{ property.seller.username|first|upper }}
        </div>
      {% endif %}

      <div>
        <p class="mb-1 fw-semibold">{{ property.seller.get_full_name|default:property.seller.username }}</p>
        <a href="{% url 'contact_seller' property.id %}" class="btn btn-danger btn-sm">
          <i class="fas fa-envelope"></i> Contact Seller/Agent
        </a>
      </div>
    </div>
  {% else %}
    <p class="text-danger">Please <a href="{% url 'login' %}">login</a> to contact the seller/agent.</p>
  {% endif %}
</div>

  <!-- Key Features -->
  <div id="features" class="mb-5">
    <h5 class="mb-3 border-bottom pb-2">Key Features</h5>
    <div class="row">
      <div class="col-md-3"><strong>Property Type:</strong> {{ property.property_type }}</div>
      <div class="col-md-3"><strong>Floor Area:</strong> {{ property.floor_area_m2 }} m²</div>
      <div class="col-md-3"><strong>Erf Size:</strong> {{ property.erf_size_m2 }} m²</div>
      <div class="col-md-3"><strong>Listing Type:</strong> {{ property.listing_type }}</div>
    </div>
  </div>

  
<div id="lightgallery" class="row g-3">
  {% for image in images %}
    <div class="col-6 col-md-3">
      <a href="{{ image.image.url }}" class="gallery-item">
        <img src="{{ image.image.url }}" class="img-fluid rounded" alt="Gallery Image">
      </a>
    </div>
  {% endfor %}
</div>




  <!-- Map View -->
  {% if property.latitude and property.longitude %}
    <div id="map" class="mb-5">
      <h5 class="mb-3 border-bottom pb-2">Map View</h5>
      <div id="map-container" class="rounded" style="height: 400px;"></div>
      <script>
        function initMap() {
          const location = { lat: {{ property.latitude }}, lng: {{ property.longitude }} };
          const map = new google.maps.Map(document.getElementById("map-container"), {
            zoom: 15,
            center: location,
          });
          new google.maps.Marker({ position: location, map: map });
        }
      </script>
      <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>
    </div>
  {% endif %}

  <!-- Other Actions -->
  <div class="mb-5">
    <h5 class="mb-3 border-bottom pb-2">Other Actions</h5>
    <div class="d-flex gap-2 flex-wrap">
      <a href="{% url 'submit_interest' property.id %}" class="btn btn-danger"><i class="fas fa-handshake"></i> Make Offer</a>
      <button class="btn btn-outline-secondary" disabled><i class="fas fa-bookmark"></i> Save</button>
      <button class="btn btn-outline-secondary" disabled><i class="fas fa-share"></i> Share</button>
      <button class="btn btn-outline-secondary" disabled><i class="fas fa-bolt"></i> Boost</button>
    </div>
  </div>

</div>

<!-- LightGallery Script -->
<link href="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/css/lightgallery.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/lightgallery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    lightGallery(document.getElementById("lightgallery"), {
      selector: '.gallery-item',
      plugins: [
        lgZoom,
        lgThumbnail,
        lgFullscreen,
        lgShare,
        lgPager,
        lgAutoplay,
        lgSwipe
      ],
      mode: 'lg-slide',
      speed: 600,
      thumbnail: true,
      download: false
    });
  });
</script>



{% endblock %}
